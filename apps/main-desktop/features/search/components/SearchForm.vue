<script lang="ts" setup>
  import { TabGroup, TabList, Tab, TabPanels, TabPanel } from '@headlessui/vue';
  import SectionFlight from 'search-module/components/SectionFlight.vue';
  import SectionHotel from 'search-module/components/SectionHotel.vue';
  import SectionBus from 'search-module/components/SectionBus.vue';
  import SectionTrain from 'search-module/components/SectionTrain.vue';

  type SearchFormProps = {
    fixed?: boolean;
    offset?: number;
  };

  type Category = {
    key: string;
    title: string;
    component?: Component;
  };

  const props = defineProps<SearchFormProps>();

  const categories: Array<Category> = [
    {
      key: 'hotel',
      title: 'Hotel',
      component: SectionHotel,
    },
    {
      key: 'flight',
      title: 'Pesawat',
      component: SectionFlight,
    },
    {
      key: 'train',
      title: 'Kereta Api',
      component: SectionTrain,
    },
    {
      key: 'bus',
      title: 'Bus & Travel',
      component: SectionBus,
    },
  ];

  const tabPanel = ref();
  const { width: tabPanelWidth } = useElementBounding(tabPanel);
</script>

<template>
  <TabGroup as="div" class="relative">
    <TabList class="bg-neutral-tuna-25 flex w-max flex-row rounded-t-xl">
      <Tab
        v-for="merchant in categories"
        as="template"
        :key="merchant.key"
        v-slot="{ selected }"
      >
        <button
          :class="[
            'after:border-neutral-tuna-200 relative m-0.5 flex flex-row items-center justify-center gap-2 border-b-2 px-3 py-2 text-base font-bold outline-none after:absolute after:-right-0.5 after:h-1/4 after:w-1/2 after:border-r last:after:hidden',
            selected
              ? 'border-b-orange-inter-600 text-orange-inter-600'
              : 'text-neutral-tuna-300 border-b-transparent',
          ]"
        >
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path
              v-if="merchant.key === 'hotel'"
              d="M18.5884 2H5.4116C5.1853 2 5 2.1835 5 2.417V21.5833C5 21.8123 5.1853 21.9998 5.4116 21.9998H9.94123V18.8039C9.94123 17.6584 10.8633 16.7209 12.0002 16.7209C13.1367 16.7209 14.0588 17.6584 14.0588 18.8039V21.9998H18.5884C18.8147 21.9998 19 21.8123 19 21.5833V2.417C19 2.1835 18.8147 2 18.5884 2ZM15.879 6.29588H15.0553V4.69189H15.879V6.29588ZM15.879 9.77928H15.0553V8.17529H15.879V9.77928ZM15.879 13.2623H15.0553V11.6624H15.879V13.2623ZM12.4114 6.29588H11.5877V4.69189H12.4114V6.29588ZM12.4114 9.77928H11.5877V8.17529H12.4114V9.77928ZM12.4114 13.2623H11.5877V11.6624H12.4114V13.2623ZM8.94385 6.29588H8.12014V4.69189H8.94385V6.29588ZM8.94385 9.77928H8.12014V8.17529H8.94385V9.77928ZM8.94385 13.2623H8.12014V11.6624H8.94385V13.2623Z"
            />
            <path
              v-else-if="merchant.key === 'flight'"
              d="M3.10232 16.1539C3.12698 16.17 3.15165 16.1786 3.18495 16.1953L5.62392 17.2046L5.35073 17.858C5.26872 18.0647 5.31003 18.3047 5.46729 18.4614L6.05375 19.0487C6.211 19.2061 6.45089 19.2554 6.6581 19.1647L7.31054 18.8914L8.31943 21.3241C8.55932 21.8862 9.20437 22.1515 9.75815 21.9115C9.78282 21.9028 9.81612 21.8862 9.84079 21.8701L10.4939 21.5308C10.891 21.3241 11.1229 20.9021 11.0896 20.4635L10.7837 16.6419L10.817 16.6173C11.8 15.8479 12.487 15.3105 13.5532 14.3258L17.1336 19.678C17.6375 20.4388 18.663 20.6374 19.424 20.1328C19.5147 20.0748 19.5973 20.0001 19.6719 19.9261L19.9118 19.6861C20.3416 19.2554 20.4989 18.6187 20.325 18.0314L18.1253 10.9677L17.8693 10.099L17.9026 10.0657L18.2998 9.693C19.548 8.50225 20.4576 7.64157 21.1273 6.75684C21.9956 5.59878 22.4994 4.40741 22.4994 3.49738C22.508 3.17471 22.4254 2.86067 22.2515 2.58797C22.2021 2.52134 22.1528 2.45532 22.0862 2.39732C22.0282 2.33933 21.9709 2.28935 21.9043 2.24863C21.6317 2.07465 21.3172 1.99198 20.9867 2.00061C20.0771 2.00061 18.8943 2.50468 17.7368 3.37337C16.8438 4.03476 15.9842 4.94541 14.7933 6.21082L14.3888 6.62481L6.46754 4.17605C5.88046 3.99404 5.25207 4.15075 4.81361 4.58942L4.57433 4.82942C3.92929 5.47416 3.92929 6.51684 4.57433 7.16219C4.64833 7.23684 4.73159 7.31088 4.82224 7.36887L10.18 10.9504C9.18772 12.0264 8.64196 12.7211 7.86494 13.7052L4.01994 13.4238C3.57408 13.3905 3.16028 13.6225 2.9537 14.0198L2.61452 14.6732C2.34997 15.2025 2.55655 15.8726 3.10232 16.1539Z"
            />
            <path
              v-else-if="merchant.key === 'train'"
              d="M12 10.1254C14.8112 10.1254 16.4545 10.1254 17.0909 9.50037C17.7272 8.87535 17.7272 8.24084 17.7272 6.68781C17.7272 5.13478 17.7272 4.50027 17.0909 3.87526C16.4545 3.25024 14.8112 3.25024 12 3.25024C9.18878 3.25024 7.54543 3.25024 6.90907 3.87526C6.2727 4.50027 6.2727 5.13478 6.2727 6.68781C6.2727 8.24084 6.2727 8.87535 6.90907 9.50037C7.54543 10.1254 9.18878 10.1254 12 10.1254ZM13.9089 12.9378C13.9089 13.8013 14.6206 14.5003 15.4998 14.5003C16.3785 14.5003 17.0907 13.8013 17.0907 12.9378C17.0907 12.0748 16.3785 11.3752 15.4998 11.3752C14.6206 11.3752 13.9089 12.0748 13.9089 12.9378ZM6.90905 12.9378C6.90905 13.8013 7.62076 14.5003 8.49996 14.5003C9.37865 14.5003 10.0909 13.8013 10.0909 12.9378C10.0909 12.0748 9.37865 11.3752 8.49996 11.3752C7.62076 11.3752 6.90905 12.0748 6.90905 12.9378ZM12 2C15.5137 2 17.7273 2 18.3636 2.62501C19 3.25002 19 5.70307 19 9.50015C19 12.5417 18.999 14.7188 18.6711 15.7858C18.5897 16.0513 18.4899 16.2513 18.3636 16.3753C18.298 16.4403 18.2119 16.4958 18.1127 16.5473C17.2533 16.9993 15.1523 17.0003 12 17.0003C8.84771 17.0003 6.74618 16.9993 5.88684 16.5473C5.78756 16.4958 5.70255 16.4403 5.63636 16.3753C5.5096 16.2513 5.40982 16.0513 5.32836 15.7858C5.00051 14.7188 5 12.5417 5 9.50015C5 5.70307 5 3.25002 5.63636 2.62501C6.27273 2 8.48575 2 12 2ZM8.21607 19.4993L7.81847 20.1243H16.1823L15.7842 19.4993H8.21607ZM14.5639 17.5824C15.1102 17.5624 15.5928 17.5354 16.0138 17.5024L18.2665 21.044C18.4534 21.337 18.3628 21.7225 18.0649 21.9055C17.9601 21.9695 17.8435 22 17.7284 22C17.5166 22 17.3084 21.8965 17.1878 21.7065L16.9775 21.375H7.02327L6.81199 21.7065C6.69134 21.8965 6.48414 22 6.27185 22C6.15679 22 6.04021 21.9695 5.93483 21.9055C5.63752 21.7225 5.54639 21.337 5.73272 21.044L7.98697 17.5024C8.40748 17.5354 8.88959 17.5624 9.43687 17.5824L9.01178 18.25H14.9885L14.5639 17.5824ZM15.4998 12C16.0267 12 16.4544 12.42 16.4544 12.9375C16.4544 13.4555 16.0267 13.875 15.4998 13.875C14.9724 13.875 14.5453 13.4555 14.5453 12.9375C14.5453 12.42 14.9724 12 15.4998 12ZM9.4545 12.9375C9.4545 12.42 9.02686 12 8.49995 12C7.97253 12 7.5454 12.42 7.5454 12.9375C7.5454 13.4555 7.97253 13.875 8.49995 13.875C9.02686 13.875 9.4545 13.4555 9.4545 12.9375Z"
            />
            <path
              v-else-if="merchant.key === 'bus'"
              d="M21.4794 6.08187H21.0712V4.245C21.0712 3.57187 20.5456 2.85625 19.9025 2.65562C19.9025 2.65562 17.8056 2 12.5 2C7.19375 2 5.09687 2.65562 5.09687 2.65562C4.45438 2.85625 3.92812 3.57187 3.92812 4.245V6.08187H3.52062C2.95875 6.08187 2.5 6.54125 2.5 7.10187V9.55125C2.5 10.1119 2.95875 10.5719 3.52062 10.5719H3.92812V19.755H4.54125V20.1631C4.54125 21.1737 5.3675 22 6.3775 22C7.3875 22 8.21438 21.1737 8.21438 20.1631V19.755H16.7863V20.1631C16.7863 21.1737 17.6125 22 18.6225 22C19.6325 22 20.4587 21.1737 20.4587 20.1631V19.755H21.0712V10.5719H21.4794C22.0412 10.5719 22.5 10.1119 22.5 9.55125V7.10187C22.5 6.54125 22.0412 6.08187 21.4794 6.08187ZM18.4181 18.3269C17.8543 18.3269 17.3975 17.87 17.3975 17.3063C17.3975 16.7431 17.8543 16.2856 18.4181 16.2856C18.9818 16.2856 19.4387 16.7431 19.4387 17.3063C19.4387 17.87 18.9818 18.3269 18.4181 18.3269ZM6.58215 18.3269C6.0184 18.3269 5.56152 17.87 5.56152 17.3063C5.56152 16.7431 6.0184 16.2856 6.58215 16.2856C7.1459 16.2856 7.60277 16.7431 7.60277 17.3063C7.60277 17.87 7.1459 18.3269 6.58215 18.3269ZM6.56152 13.8365C6.00924 13.8365 5.56152 13.3888 5.56152 12.8365V7.08154C5.56152 6.52926 6.00924 6.08154 6.56152 6.08154H18.439C18.9913 6.08154 19.439 6.52926 19.439 7.08154V12.8365C19.439 13.3888 18.9913 13.8365 18.439 13.8365H6.56152ZM9.43848 4.04062C9.43848 4.49142 9.80392 4.85687 10.2547 4.85687H14.7447C15.1955 4.85687 15.561 4.49142 15.561 4.04062C15.561 3.58981 15.1955 3.22437 14.7447 3.22437H10.2547C9.80392 3.22437 9.43848 3.58981 9.43848 4.04062Z"
            />
          </svg>
          {{ merchant.title }}
        </button>
      </Tab>
    </TabList>

    <TabPanels
      ref="tabPanel"
      class="shadow-lifted min-h-[150px] w-[calc(100vw-128px)] min-w-[975px] max-w-[1366px] rounded-xl rounded-tl-none bg-white"
      :class="{
        'fixed top-[64px] grid rounded-tr-none': props.fixed,
      }"
      :style="{
        top: `${64 + Math.max(offset || 0, 0)}px`,
        left: `calc(50% - ${tabPanelWidth / 2}px)`,
      }"
    >
      <TabPanel v-for="(merchant, idx) in categories" :key="idx">
        <div class="px-6 pb-4 pt-3">
          <Component :is="merchant.component" />
        </div>
      </TabPanel>
    </TabPanels>
  </TabGroup>
</template>
